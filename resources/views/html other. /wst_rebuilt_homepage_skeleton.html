<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI-Powered Advice Snippet</title>
    <script src="https://cdn.tailwindcss.com"></script>
     <style>
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #071016;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .transform-content {
             transition: opacity 0.5s ease-in-out;
        }
    </style>
</head>
<body class="bg-white p-8">

    <!-- This is a placeholder for the content that gets updated. -->
    <div class="grid md:grid-cols-2 gap-12 items-center">
        <div>
            <h2 id="transform-title" class="text-4xl font-bold mb-4">Advisory Services</h2>
            <p id="transform-subtitle" class="text-lg text-gray-600 mb-6">Our core services to get you started.</p>
            
            <!-- START: AI Feature HTML -->
            <div class="mt-8 pt-6 border-t">
                <label for="ai-challenge-input" class="font-semibold text-lg">Describe your challenge:</label>
                <textarea id="ai-challenge-input" rows="3" class="w-full mt-2 p-2 border rounded-md" placeholder="e.g., 'My hotel's water bills have increased by 30% this year and I don't know why.'"></textarea>
                <button id="get-ai-advice-btn" class="mt-3 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg flex items-center justify-center space-x-2">
                    <span>✨ Get Elara AI-Powered Advice From  AI </span>
                    <div id="ai-loader" class="loader hidden"></div>
                </button>
                <p id="ai-error-msg" class="text-red-500 text-sm mt-2 hidden"></p>
            </div>
             <!-- END: AI Feature HTML -->

        </div>
        <div class="relative">
            <img id="transform-image" src="elara_ai_hero_2.png" alt="Advisory Service Image" class="rounded-lg shadow-lg w-full h-96 object-cover">
            <div id="transform-overlay" class="absolute inset-0 bg-black/60 p-6 rounded-lg flex flex-col justify-end text-white transform-content">
                <h3 id="transform-overlay-title" class="text-2xl font-bold">Comprehensive Water Audits</h3>
                <p id="transform-overlay-text" class="mt-2 text-sm">We begin with a thorough audit of your property's water usage to identify key areas for improvement and savings. This forms the foundation of our strategy.</p>
                <a id="transform-overlay-link" href="#" class="mt-4 font-semibold hover:underline">More about Audits →</a>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {

        // Helper function to update the UI with new content.
        // In a real application, you would integrate this with your page's elements.
        const contentElements = {
            title: document.getElementById('transform-title'),
            subtitle: document.getElementById('transform-subtitle'),
            image: document.getElementById('transform-image'),
            overlay: document.getElementById('transform-overlay'),
            overlayTitle: document.getElementById('transform-overlay-title'),
            overlayText: document.getElementById('transform-overlay-text'),
            overlayLink: document.getElementById('transform-overlay-link')
        };
        
        function updateTransformSection(content, isAi) {
            Object.values(contentElements).forEach(el => el.style.opacity = '0');
            setTimeout(() => {
                contentElements.title.textContent = content.title;
                contentElements.subtitle.textContent = content.subtitle;
                contentElements.image.src = isAi ? 'elara_ai_hero_2.png' : content.image;
                contentElements.overlayTitle.textContent = content.overlayTitle;
                contentElements.overlayText.textContent = content.overlayText;
                contentElements.overlayLink.href = content.overlayLink || '#';
                Object.values(contentElements).forEach(el => el.style.opacity = '1');
            }, 500);
        }

        // --- START: Gemini AI Feature JavaScript ---
        const getAdviceBtn = document.getElementById('get-ai-advice-btn');
        const aiInput = document.getElementById('ai-challenge-input');
        const aiLoader = document.getElementById('ai-loader');
        const aiErrorMsg = document.getElementById('ai-error-msg');

        getAdviceBtn.addEventListener('click', async () => {
            const userChallenge = aiInput.value.trim();
            if (!userChallenge) {
                aiErrorMsg.textContent = 'Please describe your challenge first.';
                aiErrorMsg.classList.remove('hidden');
                return;
            }

            aiLoader.classList.remove('hidden');
            aiErrorMsg.classList.add('hidden');
            getAdviceBtn.disabled = true;

            // 1. Define the prompt for the AI. This tells the AI its role and what to do.
            const prompt = `You are a world-class water management consultant. A potential client has described their business challenge. Based on their challenge, generate a concise, professional advisory plan. The client's challenge is: "${userChallenge}". Respond ONLY with a JSON object.`;
            
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];

            // 2. Define the exact JSON structure you want the AI to return.
            // This makes the response predictable and easy to use.
            const payload = {
                contents: chatHistory,
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "title": { "type": "STRING", "description": "A short, catchy title for this custom advisory plan." },
                            "subtitle": { "type": "STRING", "description": "A one-sentence subtitle that summarizes the approach." },
                            "overlayTitle": { "type": "STRING", "description": "A clear headline for the solution." },
                            "overlayText": { "type": "STRING", "description": "A 2-3 sentence paragraph detailing the proposed solution or next steps." }
                        },
                        required: ["title", "subtitle", "overlayTitle", "overlayText"]
                    }
                }
            };
            
            // 3. Make the API call to Gemini.
            try {
                // IMPORTANT: Replace "YOUR_API_KEY_HERE" with your actual Google AI Studio API key.
                const apiKey = "AIzaSyA3IlhRLqoVXo9IllNKGezYkyy2Va8X8Jc"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status} ${response.statusText}`);
                }

                const result = await response.json();
                
                // 4. Process the successful response.
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const aiResponseText = result.candidates[0].content.parts[0].text;
                    const aiContent = JSON.parse(aiResponseText);
                    
                    // Use the helper function to update your page's content.
                    updateTransformSection(aiContent, true);

                } else {
                    throw new Error("Received an invalid response from the AI.");
                }

            } catch (error) {
                // 5. Handle any potential errors.
                console.error("AI Advice Error:", error);
                aiErrorMsg.textContent = "Sorry, we couldn't generate advice at this moment. Please check your API key and try again later.";
                aiErrorMsg.classList.remove('hidden');
            } finally {
                // 6. Reset the button and loader.
                aiLoader.classList.add('hidden');
                getAdviceBtn.disabled = false;
            }
        });
        // --- END: Gemini AI Feature JavaScript ---
    });
    </script>

</body>
</html>
